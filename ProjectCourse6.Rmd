---
title: "ProjectCourse"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

Dit is een R Markdown document voor het project van course 6 gemaakt door groep 1. blablabla

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


```{r include = FALSE}
library(edgeR)
require(limma)
```
### Huidige werkmap instellen naar map waar script in staat. 
```{r}
setwd(dirname(rstudioapi::getSourceEditorContext()$path)) 
#fDir <-  file.choose()
```
### read counts
```{r}

inhoud = read.table("./RNAseq-bestanden/RNA-Seq-counts.txt", header=TRUE)
row.names(inhoud) = inhoud[,"ID"]
annotatie = read.table("./RNAseq-bestanden/WCFS1_anno.txt", header=TRUE, sep="\t"
                  , quote="")
names(annotatie)[names(annotatie) == "name"] = "ID"
data = merge(inhoud, annotatie, by="ID")
```

### Create DGEList
```{r}
#exp <- c("WCFS1.glc","WCFS1.glc","WCFS1.rib","WCFS1.rib")

group <- factor(c("WCFS1.glc",	"WCFS1.glc",	"WCFS1.rib"
                 , "WCFS1.rib", "NC8.glc", "NC8.glc"	
                 , "NC8.rib", "NC8.rib"))
x <- DGEList(counts=data[,2:9], group=group)
```

### Normalise counts
### Trimmed mean of M values : remove lowest and highest values
### (percentile) and calculate mean
```{r}
x <- calcNormFactors(x, method="TMM" )
keep <- filterByExpr(x)
x <- x[keep, , keep.lib.sizes=FALSE]
x$samples$lib.size = colSums(x$counts)
```

### Check statistics
```{r}
#print("Count statistics")
#print(summary(x$counts))
#print(x$samples)
```

### Create design matrix
```{r}
design <- model.matrix(~0+group, data=x$samples)
colnames(design) <- levels(x$samples$group)
```

### Estimate Dispersion
```{r}
x <- estimateGLMCommonDisp(x,design)
x <- estimateGLMTrendedDisp(x,design, method="power")
x <- estimateGLMTagwiseDisp(x,design)
```

### Plot results
```{r}
pdf(paste0("test.pdf"))
plotMDS(x)
plotBCV(x)
dev.off()
```

### Fit data
```{r}
fit <- glmFit(x,design)
```





# Code hieronder nog bijwerken/opschonen.

### Dit nog uitwerken, zie issue #4
```{r}
# Hier maak je een dataframe met de informatie die je wilt vergelijken 
#df=data.frame(group=rep(c("A","B"),5), value1=1:10,value2=21:30,value3=41:50,stringsAsFactors = F)
#df
# Dit is de code om een Fold Change te berekening uit de limma package 
#res=aggregate(.~group,df,mean) 
#res["fc",]=c("A.vs.B",as.numeric(res[1,-1])/as.numeric(res[2,-1])) 
#res
```

### P-waarde berekenen
```{r}
mc <- makeContrasts(exp.r=WCFS1.glc-WCFS1.rib, levels=design)

fit <- glmLRT(fit, contrast=mc)
```
### Print top tags
```{r}
res<-topTags(fit)
print(res)
```
### Correlatie van de data
```{r}
cor.test(y$counts[,1], y$counts[,2])
cor.test(y$counts[,3], y$counts[,4])
```
### Alle p-values
```{r}
PV <- fit[["table"]][["PValue"]]
head(PV, 100)
```
